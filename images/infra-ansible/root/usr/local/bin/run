#!/bin/bash
set -e

USER_ID=$(id -u)
GROUP_ID=$(id -g)

# Patch /etc/passwd file with the current user info.
# The current user's entry must be correctly defined in this file in order for
# the `ssh` command to work within the created container.

if ! whoami &>/dev/null; then
  echo "${USER:-default}:x:${USER_ID}:${GROUP_ID}:Default User:$HOME:/sbin/nologin" >> /etc/passwd
fi

exec "$@"
